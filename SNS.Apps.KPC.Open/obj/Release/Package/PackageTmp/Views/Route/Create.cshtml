@model SNS.Apps.KPC.Libs.Models.RouteCreateRequest

@using SNS.Apps.KPC.Libs.Configurations;
@using SNS.Apps.KPC.Libs.Models
@using SNS.Apps.KPC.Libs.Utils

@{
    ViewBag.Title = "快拼车";
    Layout = "~/Views/Shared/_LayoutList.cshtml";
}

@section head
{
    @Styles.Render("~/Content/route/create")
    <style>
        html {
            width: 100%;
            height: 100%;
        }

        body {
            background-color: white;
        }

        #wrapper ul li {
            border: none;
        }

        .div_c1 {
            padding: 0px 10px;
            border: 1px solid #cacaca;
            border-top: none;
        }

        #address input[type="text"], #wrapper input[type="text"], #wrapper input[type="password"] {
            /*
            display: flex;
            line-height: 25px;
            -webkit-box-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            */
            border: none;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            width: 100%;
            padding: 5px;
            box-shadow: none;
            -webkit-appearance: none;
        }

        input[type="text"], textarea {
            -webkit-appearance: none;
        }

        input[type="button"], input[type="button"]:visited {
            /*
            background: -ms-linear-gradient(#0faf0f,#008001);
            background: -o-linear-gradient(#0faf0f,#008001);
            background: -moz-linear-gradient(#0faf0f,#008001);
            background: -webkit-gradient(linear, 0% 0, 0% 100%, from(#0faf0f), to(#008001));
            */
            background-color: #2f8d13;
            border: 1px solid #008001;
            box-shadow: rgba(255, 255, 255, 0.298039) 0px 1px 0px 0px inset, rgb(204, 204, 204) 1px 1px 4px 0px;
        }

            input[type="button"]:active {
                /*
                background: -ms-linear-gradient(#005801,#008001);
                background: -o-linear-gradient(#005801,#008001);
                background: -moz-linear-gradient(#005801,#008001);
                background: -webkit-gradient(linear, 0% 0, 0% 100%, from(#005801), to(#008001));
                    */
            }

        .arrow_right::after {
            content: ' ';
            position: absolute;
            width: 9px;
            height: 14px;
            top: 40%;
            right: 25px;
            background: url("/Content/images/arrow_right.png") -9px 0 no-repeat;
        }

        #fromcity_div:active, #tocity_div:active, #fromcity:active, #tocity:active {
            background-color: #eee;
        }

        label.selected {
            background-color: green;
            color: white;
        }
    </style>
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    @Html.HiddenFor(m => m.Route.From_Province, new { id = "from_province" })
    @Html.HiddenFor(m => m.Route.From_District, new { id = "from_district" })
    @Html.HiddenFor(m => m.Route.To_Province, new { id = "to_province" })
    @Html.HiddenFor(m => m.Route.To_District, new { id = "to_district" })
    @Html.HiddenFor(m => m.Route.From_Point.Longitude, new { id = "from_lng" })
    @Html.HiddenFor(m => m.Route.From_Point.Latitude, new { id = "from_lat" })
    @Html.HiddenFor(m => m.Route.To_Point.Longitude, new { id = "to_lng" })
    @Html.HiddenFor(m => m.Route.To_Point.Latitude, new { id = "to_lat" })

    @RenderPage("/Views/Shared/_Navbar.cshtml")
    <div id="wrapper" style="min-height:300px">
        <div class="header">
            <span id="navbar" class="headermenu"></span>
            <div class="headertitle">发布路线</div>
        </div>
        <ul>
            <li class="search" style="padding:0px;line-height:38px;border-bottom:none;">
                <div id="sxb" style="float: left; text-align: center; width: 49.6%; border-right: 1px solid #ccc;">同城</div>
                <div id="ct" class="active" style="float:left;text-align:center;width:50%;">长途</div>
                <input type="radio" id="radiosxb" name="pinchetype" value="sxb" style="display:none;" checked="checked" />
                <input type="radio" id="radioct" name="pinchetype" value="ct" style="display:none;" />
            </li>
            <li class="search">
                <div id="fromcity_div" class="div_c1 arrow_right" style="border-top:1px solid #cacaca;margin-top:10px;">
                    <span class="title">城市</span>
                    @Html.TextBoxFor(model => model.Route.From_City, new { Readonly = "readonly", id = "fromcity", style = "width:70%;", placeholder = "选择起点城市" })
                    <select style="display:none;">
                        <option>选择区/县</option>
                        <option>浦东新区</option>
                        <option>闵行区</option>
                        <option>普陀区</option>
                        <option>杨浦区</option>
                    </select>
                </div>
            </li>
            <li class="search">
                <div class="div_c1">
                    <span class="title">起点</span>
                    @Html.TextBoxFor(model => model.Route.From_Location, new { Readonly = "readonly", placeholder = "请输入详细地址(必填)", style = "width:70%", id = "from_map", Class = "mapvalue" })
                    <span id="from" class="mappop" style="position: absolute; width:12%;top:0px;right:0px;"><img src="~/Content/images/kpc_map_pin_from.png" style="vertical-align:middle;line-height:30px;height:30px;" /></span>
                </div>
            </li>
            <li class="search" id="destination" style="display:none;">
                <div id="tocity_div" class="div_c1 arrow_right" style="border-top:1px solid #cacaca;margin-top:10px;">
                    <span class="title">城市</span>
                    @Html.TextBoxFor(m => m.Route.To_City, new { style = "width:70%", id = "tocity", placeholder = "选择终点城市", Readonly = "readonly" })
                    <select style="display:none;">
                        <option>选择区/县</option>
                        <option>浦东新区</option>
                        <option>闵行区</option>
                        <option>普陀区</option>
                        <option>杨浦区</option>
                    </select>
                </div>
            </li>
            <li class="search">
                <div class="div_c1">
                    <span class="title">终点</span>
                    @Html.TextBoxFor(model => model.Route.To_Location, new { Readonly = "readonly", placeholder = "请输入详细地址(必填)", id = "to_map", style = "width:70%", Class = "mapvalue" })
                    <span id="to" class="mappop" style="position: absolute;width:12%;top:0px;right:0px;"><img src="~/Content/images/kpc_map_pin_to.png" style="vertical-align:middle;line-height:30px;height:30px;" /></span>
                </div>
            </li>
            <li class="search" id="tc">
                <div class="div_c1" style="border-top:1px solid #cacaca;margin-top:10px;">
                    <!--<span class="title">
                        类型
                    </span>-->
                    <table cellspacing="0" style="table-layout:fixed;display:inline-block;vertical-align:middle;" cellpadding="0">
                        <tr>
                            <td>
                                <label id="typeworkday" for="workday" style="padding:5px 15px;display:inline;text-align:center;" class="selected">工作日</label>
                            </td>
                            <td>
                                <label id="typetwoday" for="twoday" style="padding: 5px 15px; display: inline; text-align: center; ">周末</label>
                            </td>
                            <td>
                                <label id="typetempday" for="tempday" style="padding: 5px 15px; display: inline; text-align: center; ">临时</label>
                            </td>
                            <td>
                                <label id="typeeachday" for="eachday" style="padding: 5px 15px; display: inline; text-align: center; ">每天</label>
                            </td>
                        </tr>
                    </table>
                    <input type="radio" style="display:none;" name="daysection" checked="checked" id="workday" value="1" />
                    <input type="radio" style="display:none;" name="daysection" id="twoday" value="2" />
                    <input type="radio" style="display:none;" name="daysection" id="tempday" value="4" />
                    <input type="radio" style="display:none;" name="daysection" id="eachday" value="8" />
                </div>
            </li>
            <li id="sxb_date" class="search">
                <div class="div_c1">
                    <span class="title">
                        时间
                    </span>
                    <input type="text" value="@ViewBag.StartDate_Date" name="startdate_date_temp" id="startdate_date_temp" style="display:none;width:35%;" />
                    <input type="text" value="@ViewBag.StartDate_Time" name="startdate_time" id="StartDate_Time" placeholder="请输入出发时间" style="width:70%;" />
                </div>
            </li>
            <li id="ct_date" class="search ct">
                <div class="div_c1">
                    <span class="title">
                        日期
                    </span>
                    <input type="text" value="@ViewBag.StartDate_Date" name="startdate_date" id="StartDate_Date" placeholder="请输入出发日期" style="width:70%;" />
                    <!--<input type="checkbox" value="true" id="isLongTerm" name="islongterm" /><label for="isLongTerm">长期有效</label>-->
                </div>
            </li>
            <li class="search" style="height:51px;">
                <div class="div_c1">
                    <span class="title">
                        我是
                    </span>
                    <table cellspacing="0" style="table-layout:fixed;display:inline-block;vertical-align:middle;" cellpadding="0">
                        <tr>
                            <td>
                                <label id="rolepassenger" for="radiopassenger" style="padding:5px 20px;display:inline;text-align:center;" @(Model.UserRole == UserRole.Passenger ? "class=selected" : "")>乘客</label>
                            </td>
                            <td>
                                <label id="roledriver" for="radiodriver" style="padding: 5px 20px; display: inline; text-align: center;" @(Model.UserRole == UserRole.Driver ? "class=selected" : "")>车主</label>
                            </td>
                        </tr>
                    </table>
                    @Html.RadioButtonFor(model => model.UserRole, UserRole.Passenger.ToString(), new { id = "radiopassenger", style = "display:none" })
                    @Html.RadioButtonFor(model => model.UserRole, UserRole.Driver.ToString(), new { id = "radiodriver", style = "display:none" })
                </div>
            </li>
            <li id="peoplecount" class="@(Model.UserRole == UserRole.Passenger ? "search" : "search ct")">
                <div class="div_c1">
                    <span class="title">
                        人数
                    </span>
                    <input type="text" name="passengernum" id="passengernum" placeholder="人数" style="width:20%;" />人
                </div>
            </li>
            <li id="driverstyle" class="search" style="display:none;">
                <div class="div_c1">
                    <span class="title">信息</span>
                    @Html.TextBoxFor(model => model.Route.SeatCount, new { id = "seatcount", placeholder = "座位数", style = "width:20%;", maxlength = "3" })&nbsp;座&nbsp;
                    @Html.TextBoxFor(model => model.Route.Charge, new { id = "charge", placeholder = "面议", maxlength = "5", style = "width:20%;" })&nbsp;元/人
                </div>
            </li>
            <li>
                <div class="div_c1">
                    <span class="title" style="line-height:70px;vertical-align:top;">备注</span>
                    @Html.TextAreaFor(mode => mode.Route.Note, new { placeholder = "请输入备注信息", style = "font-size:16px; overflow-y:visible;border:none;/*border-color:rgb(238, 238, 238);*/width:80%;", Maxlength = "300", rows = "3" })
                </div>
            </li>
            <li style="text-align:center; border-bottom:none; margin-top:10px;">
                <input id="btn_search" type="button" value="正在加载中" style="border: none; font-size:20px;border-radius:3px; width: 100%; height: 50px; color: white; text-align: center;" />
            </li>
        </ul>
        @RenderPage("/Views/Shared/_Footer.cshtml")

    </div>
    @Scripts.Render("~/bundles/route/loadcreate")
    <div id="address" style="min-height:300px" class="hideback">
        <div class="header">
            <span id="backbtn" class="backbtn">
                <!--<img src="/content/images/back.png" width="25" height="25" style="vertical-align:middle; " />-->
            </span>
        </div>
        <br />
        <span style="padding:0px 10px;" id="cityown"></span>
        <div style="padding:0px 10px;">
            <table width="100%" style="table-layout:fixed">
                <tr>
                    <td width="80%">
                        <input type="text" style="border: 1px solid rgb(238,238,238); width: 100%; min-height: 1.4em; line-height: 1.4em;" placeholder="请输入详细地址" id="address_text" />
                    </td>
                    <td>
                        <span id="btn_address" style="border-radius:3px;padding: 0.4em 0.5em;text-align:center; background-color: #009900;color:white;">确定</span>
                    </td>
                </tr>
            </table>
        </div>
        <ul id="suggest"></ul>
    </div>

    <div id="popupMap" style="display: none; width: 100%; height: 100%; border: none">
        <div class="header">
            <span id="cancel" class="backbtn">
                <!--<img src="/content/images/back.png" width="25" height="25" style="vertical-align:middle" />-->
            </span>
            <span id="ok" style="position: absolute; right: 0px; border-radius: 3px; background-color: darkgreen; border: 1px solid #2f8d13; height: 35px; line-height: 35px; margin: 7px 10px; padding: 0 10px">确定</span>
        </div><!-- navbar -->
        <div id="div_location" style="position: absolute; top: 50px; padding: 0.7em 0em; width: 100%; background-color: black; opacity: 0.6; filter: alpha(opacity=60); text-align: center; color: white; left: 0; z-index: 10">请在地图上点选</div>
        <div id="mapdiv" style="position:absolute;width:100%;border:none;"></div>
    </div>
}

<div id="shade_bottom"></div>
<div id="shade_top_div" style="background-color:white">
    <img src="~/Content/images/loading.gif" />
    正在处理中，请耐心等待
</div><!-- /Shade -->
@*<script type="text/javascript" src="@(string.Format(ConfigStore.MapAPISettings.Baidu_Map_URI, ConfigStore.MapAPISettings.MapAPIKey))"></script>*@
<script src="/Scripts/view/baidu.js"></script>
@Scripts.Render("~/bundles/route/create")
@Scripts.Render("~/bundles/route/maplocation")

<script>
    /*
    window.onload = function () {
        document.getElementById("loadmap").src = "/bundles/route/maplocation?v=" + (new Date()).getMonth();
    };
    */
    var roleselect = "@(Model.UserRole == UserRole.Passenger?"rolepassenger":"roledriver")";
</script>
<script id="loadmap"></script>

@if (!string.IsNullOrEmpty(ViewBag.ErrorMsg))
{
    <script type="text/javascript">
        alert("@ViewBag.ErrorMsg");
    </script>
}
@model IEnumerable<SNS.Apps.KPC.Libs.Models.UserRouteResult>
@using SNS.Apps.KPC.Libs.Models
@using SNS.Apps.KPC.Libs.Utils

@{
    Layout = "~/Views/Shared/_LayoutList.cshtml";
    ViewBag.Title = "快拼车";
}

@section head{
    @Styles.Render("~/Content/route/listview")
    <style>
        #searchresult li:nth-child(2n+1) {
            background-color: white;
        }

        #searchresult li:active {
            background-color: #d5d5d5;
            /*background-color: #efefef;*/
        }
    </style>
    <script>
        var IsShowWait = false;
        if (location.hash.indexOf('#w') === -1) {
            // 不是从微信消息进来的
            IsShowWait = true;
        }
    </script>

}

@RenderPage("/Views/Shared/_Navbar.cshtml")

<div id="wrapper">
    <div class="header">
        <span id="navbar" class="headermenu"></span>
        <div class="headertitle">我的路线</div>
    </div>
    <ul id="searchresult">
        @foreach (var item in Model)
        {
            <li>
                <a onclick="if (IsShowWait) showWait();" href="/route/detail/@item.Route.RouteGUID#mp.weixin.qq.com@(HttpContext.Current.Request.UrlReferrer == null ? "#flag" : "")" style="display:block">
                    <table width="100%" cellspacing="0">
                        <tr style="text-align: center; height:60px">
                            <td width="38%">
                                <span style="line-height:25px; font-weight:bold;">
                                    @(item.Route.From_City == item.Route.To_City ? item.Route.From_District : item.Route.From_City)
                                </span>
                                <div style="line-height: 25px; font-size: 14px;">
                                    @(item.Route.From_Location)
                                </div>
                            </td>
                            <td width="24%" style="font-size: 13px;color: #797979;">
                                @switch (item.Route.RouteType)
                                {
                                    case RouteType.Citywide_Workday:
                                        @(item.Route.StartDate.Value.ToString("工作日 HH:mm 出发"));
                                        break;
                                    case RouteType.Citywide_Weekend:
                                    @(item.Route.StartDate.Value.ToString("周末 HH:mm 出发"));
                                    break;
                                    case RouteType.Citywide_Temp:
                                    @(item.Route.StartDate.Value.ToString("MM月dd日 HH:mm 出发"));
                                    break;
                                    case RouteType.Citywide_EveryDay:
                                    @(item.Route.StartDate.Value.ToString("每天 HH:mm 出发"));
                                    break;
                                    case RouteType.Intercity_Workday:
                                    @("工作日 有效");
                                    break;
                                    case RouteType.Intercity_Weekend:
                                    @("周末 有效");
                                    break;
                                    case RouteType.Intercity_Temp:
                                    @(item.Route.StartDate.Value.ToString("MM月dd日 出发"));
                                    break;
                                    case RouteType.Intercity_EveryDay:
                                    @("长期有效");
                                    break;
                                    default:
                                    break;
                                }
                            </td>
                            <td width="38%">
                                <span style="line-height:25px; font-weight:bold;">
                                    @(item.Route.From_City == item.Route.To_City ? item.Route.To_District : item.Route.To_City)
                                </span>
                                <div style="line-height: 25px; font-size: 14px;">
                                    @(item.Route.To_Location)
                                </div>
                            </td>
                        </tr>
                    </table>
                </a>
            </li>
        }
    </ul>

    <div id="shade" style="text-align:center;display:none">
        <img src="~/Content/images/loading.gif" />正在加载中...
    </div>
    @RenderPage("/Views/Shared/_Footer.cshtml")

</div>

@Scripts.Render("~/bundles/route/list")

<script type="text/template" id="routelist_template">
    <% _.each(datas, function(item) { %>
    <li>
        <% var flag = "@(HttpContext.Current.Request.UrlReferrer == null ? "#flag" : "")"%>
        <a onclick="if (IsShowWait) showWait();" href="/route/detail/<%= item.Route.RouteGUID %>#mp.weixin.qq.com<%= flag %>" style="display:block">
            <table width="100%" cellspacing="0">
                <tr style="text-align:center;height:60px; ">
                    <td width="38%">
                        <span style="line-height:25px; font-weight:bold;">
                            <%= item.Route.From_City === item.Route.To_City ? item.Route.From_District : item.Route.From_City %>
                        </span>
                        <div style="line-height: 25px; font-size: 14px;">
                            <%= item.Route.From_Location %>
                        </div>
                    </td>
                    <td width="24%" style="font-size: 13px;color: #797979;">
                        <% switch(item.Route.RouteType) { case 17: %>
                        <% var len = item.Route.StartDate.length, datestring = item.Route.StartDate.substring(6, len-2); dateobj =new Date(parseInt(datestring)); %>
                        工作日
                        <%= dateobj.getHours() < 10 ? '0' + dateobj.getHours() : dateobj.getHours() %>:<%= dateobj.getMinutes() < 10 ? '0' + dateobj.getMinutes() : dateobj.getMinutes() %>
                        出发
                        <% break; case 18: %>
                        <% var len = item.Route.StartDate.length, datestring = item.Route.StartDate.substring(6, len-2); dateobj =new Date(parseInt(datestring)); %>
                        周末
                        <%= dateobj.getHours() < 10 ? '0' + dateobj.getHours() : dateobj.getHours() %>:<%= dateobj.getMinutes() < 10 ? '0' + dateobj.getMinutes() : dateobj.getMinutes() %>
                        出发
                        <% break; case 20: %>
                        <% var len = item.Route.StartDate.length, datestring = item.Route.StartDate.substring(6, len-2); dateobj =new Date(parseInt(datestring)); %>
                        <%= dateobj.getMonth() + 1 < 10 ? '0' + (dateobj.getMonth() + 1) : dateobj.getMonth() + 1 %>月<%= dateobj.getDate() < 10 ? '0' + dateobj.getDate() : dateobj.getDate() %>日

                        <%= dateobj.getHours() < 10 ? '0' + dateobj.getHours() : dateobj.getHours() %>:<%= dateobj.getMinutes() < 10 ? '0' + dateobj.getMinutes() : dateobj.getMinutes() %>
                        出发
                        <% break; case 24: %>
                        <% var len = item.Route.StartDate.length, datestring = item.Route.StartDate.substring(6, len-2); dateobj =new Date(parseInt(datestring)); %>
                        每天
                        <%= dateobj.getHours() < 10 ? '0' + dateobj.getHours() : dateobj.getHours() %>:<%= dateobj.getMinutes() < 10 ? '0' + dateobj.getMinutes() : dateobj.getMinutes() %>
                        出发
                        <% break; case 33: %>
                        工作日 有效
                        <% break; case 34: %>
                        周末 有效
                        <% break; case 36: %>
                        <% var len = item.Route.StartDate.length, datestring = item.Route.StartDate.substring(6, len-2); dateobj =new Date(parseInt(datestring)); %>
                        <%= dateobj.getMonth() + 1 < 10 ? '0' + (dateobj.getMonth() + 1) : dateobj.getMonth() + 1 %>月<%= dateobj.getDate() < 10 ? '0' + dateobj.getDate() : dateobj.getDate() %>日
                        出发
                        <% break;  case 40: %>
                        长期有效
                        <% break; default: break;%>
                        <% }%>

                    </td>
                    <td width="38%">
                        <span style="line-height:25px; font-weight:bold;">
                            <%= item.Route.From_City === item.Route.To_City ? item.Route.To_District : item.Route.To_City %>
                        </span>
                        <div style="line-height: 25px; font-size: 14px;">
                            <%= item.Route.To_Location %>
                        </div>
                    </td>
                </tr>
            </table>
        </a>
    </li>
    <% }); %>
</script>
